<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0D2137">
<title>QUOTE machine</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192.png">
<link rel="apple-touch-icon" href="/icons/icon-192.png">
<link href="https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.4.3/mapbox-gl-draw.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.4.3/mapbox-gl-draw.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Turf.js/6.5.0/turf.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/css/app.css">
</head>
<body>

<!-- LOGIN GATE -->
<div id="login-gate">
  <div class="login-card">
    <div class="login-logo">QUOTE<span>machine</span></div>
    <div class="login-sub">Enter password to continue</div>
    <input type="password" id="login-password" placeholder="Password" autocomplete="current-password">
    <button id="login-btn">Sign In</button>
    <div id="login-error" class="login-error"></div>
  </div>
</div>

<!-- HEADER -->
<header>
  <div class="logo">QUOTE<span>machine</span></div>
  <div class="header-center" id="address-display"></div>
  <div class="header-actions">
    <button class="icon-btn" id="btn-saved-header" title="Saved Quotes">ğŸ“‹ <span id="saved-count">0</span></button>
    <button class="icon-btn" id="ai-chat-btn" title="AI Assistant">ğŸ¤–</button>
  </div>
</header>

<!-- MAP -->
<div id="map-container">
  <div id="map"></div>

  <!-- Search -->
  <div id="geocoder-wrapper">
    <div id="geocoder-inner">
      <input type="text" id="addr-input" placeholder="ğŸ”  Search job address..." autocomplete="off">
      <button id="search-btn">Go</button>
    </div>
    <div id="autocomplete-list"></div>
  </div>

  <!-- Draw toolbar â€” left side -->
  <div id="map-toolbar">
    <button class="map-tool-btn active" id="tool-draw" title="Draw Area">
      <span class="tool-icon">âœï¸</span>
      <span class="tool-label">Draw</span>
    </button>
    <button class="map-tool-btn" id="tool-line" title="Measure Distance">
      <span class="tool-icon">ğŸ“</span>
      <span class="tool-label">Line</span>
    </button>
    <button class="map-tool-btn" id="tool-clear" title="Clear Drawing">
      <span class="tool-icon">ğŸ—‘</span>
      <span class="tool-label">Clear</span>
    </button>
    <button class="map-tool-btn" id="tool-satellite" title="Toggle Labels">
      <span class="tool-icon">ğŸ—º</span>
      <span class="tool-label">Labels</span>
    </button>
    <button class="map-tool-btn" id="tool-streetview" title="Street View">
      <span class="tool-icon">ğŸ‘</span>
      <span class="tool-label">360Â°</span>
    </button>
  </div>

  <!-- Drawing mode overlay â€” shown while actively drawing -->
  <!-- Drawing mode bar â€” shown while drawing, clicks pass through to map -->
  <div id="drawing-overlay" style="display:none">
    <div id="drawing-instructions">
      <strong>Tap corners</strong> of the work area
    </div>
    <div id="point-counter">0 points</div>
    <button id="btn-done-drawing">âœ“ Done â€” Calculate Area</button>
    <button id="btn-cancel-drawing">âœ• Cancel</button>
  </div>

  <!-- Measurement result badge -->
  <div id="measure-badge" style="display:none">
    <div class="badge-main">
      <span class="badge-val" id="badge-val">0</span>
      <span class="badge-unit" id="badge-unit">sq ft</span>
    </div>
    <button id="badge-clear-btn" class="badge-clear" title="Redraw">Redraw</button>
  </div>
</div>

<!-- QUOTE FORM PANEL -->
<div id="bottom-panel">
  <div class="panel-drag" id="panel-drag"><div class="drag-chevron" id="drag-chevron">â–²</div><div class="drag-bar"></div></div>
  <div class="panel-scroll" id="panel-scroll">

    <!-- View switcher -->
    <div class="tab-row">
      <button class="tab-btn active" id="tab-btn-quote">ğŸ“ New Quote</button>
      <button class="tab-btn" id="tab-btn-saved">ğŸ“‹ Saved (<span id="saved-count-tab">0</span>)</button>
      <button class="tab-btn" id="tab-btn-stats">ğŸ“Š Stats</button>
    </div>

    <!-- â•â•â• QUOTE TAB â•â•â• -->
    <div id="tab-quote">

      <!-- Measurement row â€” prominent at top -->
      <div id="measurement-row">
        <div class="mrow-area">
          <div class="mrow-label">Measured Area</div>
          <div class="mrow-value"><span id="area-display">0</span> <span id="unit-display">sq ft</span></div>
        </div>
        <div class="mrow-actions">
          <select id="measure-type" title="Unit">
            <option value="sqft">Sq Ft</option>
            <option value="linft">Lin Ft</option>
            <option value="sqyd">Sq Yd</option>
            <option value="acre">Acres</option>
          </select>
          <span class="mrow-or">or enter:</span>
          <input type="number" id="manual-area" placeholder="manual" min="0" step="1">
        </div>
      </div>

      <!-- Client + Job type -->
      <div class="form-row">
        <div class="field">
          <label>Client Name</label>
          <input type="text" id="client-name" placeholder="Name or company">
        </div>
        <div class="field">
          <label>Job Type</label>
          <select id="project-type">
            <option value="pressure-washing">Pressure Washing</option>
            <option value="parking-lot-striping">Parking Lot Striping</option>
            <option value="sealcoating">Sealcoating</option>
            <option value="painting">Painting / Coating</option>
            <option value="roofing">Roofing</option>
            <option value="concrete">Concrete</option>
            <option value="landscaping">Landscaping</option>
            <option value="custom">Other / Custom</option>
          </select>
        </div>
      </div>

      <!-- Price per unit â€” dollars dropdown + cents dropdown + optional override -->
      <div class="price-section">
        <div class="price-section-label">Price per <span id="price-unit-label">sq ft</span></div>
        <div class="price-dropdowns">
          <div class="price-drop-group">
            <label>$ Dollars</label>
            <select id="price-dollars"></select>
          </div>
          <div class="price-drop-sep">.</div>
          <div class="price-drop-group">
            <label>Â¢ Cents</label>
            <select id="price-cents"></select>
          </div>
          <div class="price-drop-group">
            <label>or enter $</label>
            <div class="price-input-wrap">
              <span class="dollar-sign">$</span>
              <input type="number" id="price-per-unit" placeholder="0.00" min="0" step="0.01">
            </div>
          </div>
        </div>
      </div>
      <div class="form-row">
        <div class="field">
          <label>Passes / Qty</label>
          <select id="qty">
            <option value="1">1Ã—</option>
            <option value="2">2Ã—</option>
            <option value="3">3Ã—</option>
            <option value="4">4Ã—</option>
            <option value="5">5Ã—</option>
          </select>
        </div>
        <div class="field">
          <label>Markup %</label>
          <select id="markup">
            <option value="0">0%</option>
            <option value="5">5%</option>
            <option value="10">10%</option>
            <option value="15">15%</option>
            <option value="20">20%</option>
            <option value="25">25%</option>
          </select>
        </div>
      </div>

      <!-- AI suggest price -->
      <button class="btn-ai-suggest" id="ai-suggest-btn">âœ¨ AI Suggest Price</button>

      <!-- TOTAL -->
      <div class="total-card">
        <div>
          <div class="total-label">Estimated Total</div>
          <div class="total-amount" id="total-display">$0.00</div>
          <div class="total-breakdown" id="breakdown-display">â€”</div>
        </div>
        <button class="btn-print-big" id="btn-print">ğŸ–¨ï¸ Print Quote</button>
      </div>

      <!-- Notes -->
      <div class="field" style="margin-top:12px">
        <label>Notes (optional)</label>
        <textarea id="notes" placeholder="Conditions, special instructions, scope details..."></textarea>
      </div>

      <!-- AI Narrative section -->
      <div id="narrative-section" style="display:none">
        <div class="narrative-header">
          AI Scope of Work
          <button class="btn-text" id="btn-narrative-regen">â†º Regenerate</button>
        </div>
        <div id="narrative-text" class="narrative-box"></div>
      </div>

      <!-- Action row -->
      <div class="action-row">
        <button class="action-btn save" id="btn-save">ğŸ’¾ Save</button>
        <button class="action-btn narrative" id="btn-narrative">âœï¸ Narrative</button>
        <button class="action-btn share" id="btn-share">ğŸ“¤ Share</button>
      </div>
      <button class="btn-new-quote" id="btn-new">ï¼‹ Start New Quote</button>

    </div><!-- end tab-quote -->

    <!-- â•â•â• SAVED TAB â•â•â• -->
    <div id="tab-saved" style="display:none">
      <div class="search-bar">
        <input type="text" id="search-input" placeholder="ğŸ”  Search by client, job type...">
        <button id="export-btn" class="btn-text-sm">Export</button>
      </div>
      <div id="saved-list"><div class="empty-state">No saved quotes yet.</div></div>
    </div>

    <!-- â•â•â• STATS TAB â•â•â• -->
    <div id="tab-stats" style="display:none">
      <div id="stats-content"><div class="empty-state">Loading...</div></div>
    </div>

  </div>
</div>

<!-- AI CHAT PANEL -->
<div id="ai-panel" class="side-panel">
  <div class="side-panel-header">
    <span>ğŸ¤– AI Assistant</span>
    <button id="ai-panel-close">âœ•</button>
  </div>
  <div id="chat-messages" class="chat-messages"></div>
  <div class="chat-input-row">
    <input type="text" id="chat-input" placeholder="Ask about pricing, measurements...">
    <button id="chat-send-btn">â¤</button>
  </div>
</div>
<div id="ai-overlay"></div>

<!-- SHARE MODAL -->
<div class="modal-overlay" id="share-modal">
  <div class="modal">
    <h3>Share Quote</h3>
    <div class="field" style="margin-bottom:12px">
      <textarea id="share-text" style="height:140px;font-size:13px;"></textarea>
    </div>
    <div class="modal-btns">
      <button class="m-btn cancel" id="share-cancel">Cancel</button>
      <button class="m-btn copy" id="share-copy">ğŸ“‹ Copy</button>
    </div>
    <div class="modal-btns" style="margin-top:8px">
      <button class="m-btn sms" id="share-sms">ğŸ’¬ Text</button>
      <button class="m-btn email" id="share-email">âœ‰ï¸ Email</button>
    </div>
  </div>
</div>

<!-- AI PRICE MODAL -->
<div class="modal-overlay" id="ai-price-modal">
  <div class="modal">
    <h3>âœ¨ AI Price Suggestion</h3>
    <div id="ai-price-content" class="ai-price-content"></div>
    <div class="modal-btns" style="margin-top:14px">
      <button class="m-btn cancel" id="ai-price-dismiss">Dismiss</button>
      <button class="m-btn copy" id="ai-price-apply">âœ“ Apply Recommended</button>
    </div>
  </div>
</div>

<!-- PULL TO REFRESH -->
<div id="ptr-indicator">
  <div class="ptr-spinner">â†»</div>
  <span>Release to refresh</span>
</div>

<!-- INSTALL BANNER -->
<div id="install-banner" class="install-banner" style="display:none">
  <div class="install-inner">
    <span>ğŸ“² Install <strong>QUOTE machine</strong> for quick access</span>
    <div class="install-btns">
      <button id="install-btn">Install</button>
      <button id="install-dismiss" class="dismiss">Later</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div id="toast"></div>

<script src="/js/app.js"></script>
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/sw.js').catch(() => {});
}
</script>
</body>
</html>
